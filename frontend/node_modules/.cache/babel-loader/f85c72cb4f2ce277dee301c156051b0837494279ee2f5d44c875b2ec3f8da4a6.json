{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/User/Downloads/prog/todo_main/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/User/Downloads/prog/todo_main/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _s = $RefreshSig$();\nimport axios from \"axios\";\nimport jwt_decode from \"jwt-decode\";\nimport dayjs from \"dayjs\";\nimport { useContext } from \"react\";\nimport AuthContext from \"../context/AuthContext\";\nvar baseURL = \"http://127.0.0.1:8000/auth\";\nvar useAxios = function useAxios() {\n  _s();\n  var _useContext = useContext(AuthContext),\n    authTokens = _useContext.authTokens,\n    setUser = _useContext.setUser,\n    setAuthTokens = _useContext.setAuthTokens;\n  var axiosInstance = axios.create({\n    baseURL: baseURL,\n    headers: {\n      Authorization: \"Bearer \".concat(authTokens === null || authTokens === void 0 ? void 0 : authTokens.access)\n    }\n  });\n  axiosInstance.interceptors.request.use( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(req) {\n      var user, isExpired, response;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            user = jwt_decode(authTokens.access);\n            isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n            if (isExpired) {\n              _context.next = 4;\n              break;\n            }\n            return _context.abrupt(\"return\", req);\n          case 4:\n            _context.next = 6;\n            return axios.post(\"\".concat(baseURL, \"/token/refresh/\"), {\n              refresh: authTokens.refresh\n            });\n          case 6:\n            response = _context.sent;\n            localStorage.setItem(\"authTokens\", JSON.stringify(response.data));\n            setAuthTokens(response.data);\n            setUser(jwt_decode(response.data.access));\n            req.headers.Authorization = \"Bearer \".concat(response.data.access);\n            return _context.abrupt(\"return\", req);\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    }));\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }());\n  return axiosInstance;\n};\n_s(useAxios, \"BY8wXILb98JGRtiYNfD1oywxzJ4=\");\nexport default useAxios;","map":{"version":3,"names":["axios","jwt_decode","dayjs","useContext","AuthContext","baseURL","useAxios","_s","_useContext","authTokens","setUser","setAuthTokens","axiosInstance","create","headers","Authorization","concat","access","interceptors","request","use","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","req","user","isExpired","response","wrap","_callee$","_context","prev","next","unix","exp","diff","abrupt","post","refresh","sent","localStorage","setItem","JSON","stringify","data","stop","_x","apply","arguments"],"sources":["C:/Users/User/Downloads/prog/todo_main/frontend/src/utils/useAxios.js"],"sourcesContent":["import axios from \"axios\";\r\nimport jwt_decode from \"jwt-decode\";\r\nimport dayjs from \"dayjs\";\r\nimport { useContext } from \"react\";\r\nimport AuthContext from \"../context/AuthContext\";\r\n\r\nconst baseURL = \"http://127.0.0.1:8000/auth\";\r\n\r\nconst useAxios = () => {\r\n  const { authTokens, setUser, setAuthTokens } = useContext(AuthContext);\r\n\r\n  const axiosInstance = axios.create({\r\n    baseURL,\r\n    headers: { Authorization: `Bearer ${authTokens?.access}` }\r\n  });\r\n\r\n  axiosInstance.interceptors.request.use(async req => {\r\n    const user = jwt_decode(authTokens.access);\r\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\r\n\r\n    if (!isExpired) return req;\r\n\r\n    const response = await axios.post(`${baseURL}/token/refresh/`, {\r\n      refresh: authTokens.refresh\r\n    });\r\n\r\n    localStorage.setItem(\"authTokens\", JSON.stringify(response.data));\r\n\r\n    setAuthTokens(response.data);\r\n    setUser(jwt_decode(response.data.access));\r\n\r\n    req.headers.Authorization = `Bearer ${response.data.access}`;\r\n    return req;\r\n  });\r\n\r\n  return axiosInstance;\r\n};\r\n\r\nexport default useAxios;"],"mappings":";;;AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,UAAU,MAAM,YAAY;AACnC,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,UAAU,QAAQ,OAAO;AAClC,OAAOC,WAAW,MAAM,wBAAwB;AAEhD,IAAMC,OAAO,GAAG,4BAA4B;AAE5C,IAAMC,QAAQ,GAAG,SAAXA,QAAQA,CAAA,EAAS;EAAAC,EAAA;EACrB,IAAAC,WAAA,GAA+CL,UAAU,CAACC,WAAW,CAAC;IAA9DK,UAAU,GAAAD,WAAA,CAAVC,UAAU;IAAEC,OAAO,GAAAF,WAAA,CAAPE,OAAO;IAAEC,aAAa,GAAAH,WAAA,CAAbG,aAAa;EAE1C,IAAMC,aAAa,GAAGZ,KAAK,CAACa,MAAM,CAAC;IACjCR,OAAO,EAAPA,OAAO;IACPS,OAAO,EAAE;MAAEC,aAAa,YAAAC,MAAA,CAAYP,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEQ,MAAM;IAAG;EAC3D,CAAC,CAAC;EAEFL,aAAa,CAACM,YAAY,CAACC,OAAO,CAACC,GAAG;IAAA,IAAAC,IAAA,GAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAAC,SAAAC,QAAMC,GAAG;MAAA,IAAAC,IAAA,EAAAC,SAAA,EAAAC,QAAA;MAAA,OAAAN,mBAAA,GAAAO,IAAA,UAAAC,SAAAC,QAAA;QAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;UAAA;YACxCP,IAAI,GAAG1B,UAAU,CAACQ,UAAU,CAACQ,MAAM,CAAC;YACpCW,SAAS,GAAG1B,KAAK,CAACiC,IAAI,CAACR,IAAI,CAACS,GAAG,CAAC,CAACC,IAAI,CAACnC,KAAK,EAAE,CAAC,GAAG,CAAC;YAAA,IAEnD0B,SAAS;cAAAI,QAAA,CAAAE,IAAA;cAAA;YAAA;YAAA,OAAAF,QAAA,CAAAM,MAAA,WAASZ,GAAG;UAAA;YAAAM,QAAA,CAAAE,IAAA;YAAA,OAEHlC,KAAK,CAACuC,IAAI,IAAAvB,MAAA,CAAIX,OAAO,sBAAmB;cAC7DmC,OAAO,EAAE/B,UAAU,CAAC+B;YACtB,CAAC,CAAC;UAAA;YAFIX,QAAQ,GAAAG,QAAA,CAAAS,IAAA;YAIdC,YAAY,CAACC,OAAO,CAAC,YAAY,EAAEC,IAAI,CAACC,SAAS,CAAChB,QAAQ,CAACiB,IAAI,CAAC,CAAC;YAEjEnC,aAAa,CAACkB,QAAQ,CAACiB,IAAI,CAAC;YAC5BpC,OAAO,CAACT,UAAU,CAAC4B,QAAQ,CAACiB,IAAI,CAAC7B,MAAM,CAAC,CAAC;YAEzCS,GAAG,CAACZ,OAAO,CAACC,aAAa,aAAAC,MAAA,CAAaa,QAAQ,CAACiB,IAAI,CAAC7B,MAAM,CAAE;YAAC,OAAAe,QAAA,CAAAM,MAAA,WACtDZ,GAAG;UAAA;UAAA;YAAA,OAAAM,QAAA,CAAAe,IAAA;QAAA;MAAA,GAAAtB,OAAA;IAAA,CACX;IAAA,iBAAAuB,EAAA;MAAA,OAAA3B,IAAA,CAAA4B,KAAA,OAAAC,SAAA;IAAA;EAAA,IAAC;EAEF,OAAOtC,aAAa;AACtB,CAAC;AAACL,EAAA,CA5BID,QAAQ;AA8Bd,eAAeA,QAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}